{"version":3,"file":"js/about.12fcf5ed.js","mappings":"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","sources":["webpack://untitled10/./src/views/HomeView2.vue","webpack://untitled10/./src/views/HomeView2.vue?7f20"],"sourcesContent":["<template>\n  <h2>1. Start your Webcam</h2>\n  <div class=\"videos\">\n      <span>\n        <h3>Local Stream</h3>\n        <video id=\"webcamVideo\" ref=\"webcamVideo\" autoplay playsinline></video>\n      </span>\n    <span>\n        <h3>Remote Stream</h3>\n        <video id=\"remoteVideo\" ref=\"remoteVideo\" autoplay playsinline controls></video>\n      </span>\n\n\n  </div>\n\n  <button id=\"webcamButton\" @click=\"start\" :disabled=\"webcamButtonDisabled\">Start webcam</button>\n  <h2>2. Create a new Call</h2>\n  <button id=\"callButton\" @click=\"create\" :disabled=\"callButtonDisabled\">Create Call (offer)</button>\n\n  <h2>3. Join a Call</h2>\n  <p>Answer the call from a different browser window or device</p>\n\n  <input id=\"callInput\" ref=\"callInput\"/>\n  <button id=\"answerButton\" @click=\"join\" :disabled=\"answerButtonDisabled\">Answer</button>\n\n  <h2>4. Hangup</h2>\n\n  <button id=\"hangupButton\" @click=\"hangup\" :disabled=\"hangButtonDisabled\">Hangup</button>\n</template>\n\n<script>\n// @ is an alias to /src\nimport HelloWorld from '@/components/HelloWorld.vue'\n\nconst servers = {\n  iceServers: [\n    {urls: 'stun:stun.l.google.com:19302'},\n    {\n      urls: 'turn:openrelay.metered.ca:80',\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    }\n  ],\n  iceCandidatePoolSize: 10,\n};\n\nexport default {\n  name: 'HomeView2',\n  components: {\n    HelloWorld\n  },\n  data() {\n    return {\n      localStream: null,\n      remoteStream: null,\n      callButtonDisabled: true,\n      answerButtonDisabled: false,\n      webcamButtonDisabled: false,\n      hangButtonDisabled: true,\n      pc1: null,\n      pc2: null,\n      socket: null,\n      callId: '',\n      isCaller: false,\n      startTime: null,\n    };\n  },\n  created() {\n    this.socket = new WebSocket('https://webrtcserverdemo-production.up.railway.app/');\n    this.socket.onopen = () => {\n      console.log('[WebSocket] 连接成功');\n    };\n    this.socket.onclose = (event) => {\n      if (event.wasClean) {\n        console.log(`[WebSocket] 连接正常关闭, code=${event.code}, reason=${event.reason}`);\n      } else {\n        console.log('[WebSocket] 连接异常断开');\n      }\n    };\n    this.socket.onerror = (error) => {\n      console.error('[WebSocket] 发生错误:', error);\n    };\n    this.socket.onmessage = this.onSocketMessage;\n    console.log('[WebRTC] Document tried to create an RTCPeerConnection', servers);\n  },\n  mounted() {\n    this.$refs.webcamVideo.addEventListener('loadedmetadata', function () {\n      console.log(`Local video videoWidth: ${this.videoWidth}px,  videoHeight: ${this.videoHeight}px`);\n    });\n    this.$refs.remoteVideo.addEventListener('loadedmetadata', function () {\n      console.log(`Remote video videoWidth: ${this.videoWidth}px,  videoHeight: ${this.videoHeight}px`);\n    });\n    this.$refs.remoteVideo.addEventListener('resize', () => {\n      console.log(`Remote video size changed to ${this.$refs.remoteVideo.videoWidth}x${this.$refs.remoteVideo.videoHeight} - Time since pageload ${performance.now().toFixed(0)}ms`);\n      if (this.startTime) {\n        const elapsedTime = window.performance.now() - this.startTime;\n        console.log('Setup time: ' + elapsedTime.toFixed(3) + 'ms');\n        this.startTime = null;\n      }\n    });\n  },\n  methods: {\n    onSocketMessage(event) {\n      const msg = JSON.parse(event.data);\n      console.log(\"websocket msg\", msg)\n      if (msg.type === 'offer' && !this.isCaller) {\n        this.pc.setRemoteDescription(new RTCSessionDescription(msg.offer));\n      }\n      if (msg.type === 'answer' && this.isCaller) {\n        this.pc.setRemoteDescription(new RTCSessionDescription(msg.answer));\n      }\n      if (msg.type === 'candidate') {\n        this.pc.addIceCandidate(new RTCIceCandidate(msg.candidate))\n            .then(() => {\n              console.log('addIceCandidate success');\n            })\n            .catch(e => {\n              console.error('addIceCandidate error', e);\n            });\n      }\n    },\n    async start() {\n      console.log('Requesting local stream');\n      this.webcamButtonDisabled = true;\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({audio: true, video: true});\n        console.log('Received local stream');\n        this.$refs.webcamVideo.srcObject = stream;\n        this.localStream = stream;\n        this.callButtonDisabled = false;\n      } catch (e) {\n        alert(`getUserMedia() error: ${e.name}`);\n      }\n    },\n    async create() {\n      this.callButtonDisabled = true;\n      this.hangButtonDisabled = false;\n      console.log('Starting call');\n      this.startTime = window.performance.now();\n      const videoTracks = this.localStream.getVideoTracks();\n      const audioTracks = this.localStream.getAudioTracks();\n      if (videoTracks.length > 0) {\n        console.log(`Using video device: ${videoTracks[0].label}`);\n      }\n      if (audioTracks.length > 0) {\n        console.log(`Using audio device: ${audioTracks[0].label}`);\n      }\n      const configuration = {\n        iceServers: [\n          {urls: 'stun:stun.l.google.com:19302'}]\n        ,\n        // iceTransportPolicy: 'relay'//强制转发\n      };\n      console.log('RTCPeerConnection configuration:', configuration);\n      this.pc1 = new RTCPeerConnection(configuration);\n      console.log('Created local peer connection object pc1');\n      this.pc1.addEventListener('icecandidate', e => this.onIceCandidate(this.pc1, e));\n      this.pc2 = new RTCPeerConnection(configuration);\n      console.log('Created remote peer connection object pc2');\n      this.pc2.addEventListener('icecandidate', e => this.onIceCandidate(this.pc2, e));\n      this.pc1.addEventListener('iceconnectionstatechange', e => this.onIceStateChange(this.pc1, e));\n      this.pc2.addEventListener('iceconnectionstatechange', e => this.onIceStateChange(this.pc2, e));\n      this.pc2.addEventListener('track', this.gotRemoteStream);\n\n      this.localStream.getTracks().forEach(track => this.pc1.addTrack(track, this.localStream));\n      console.log('Added local stream to pc1');\n\n      try {\n        console.log('pc1 createOffer start');\n        const offer = await this.pc1.createOffer({offerToReceiveAudio: 1, offerToReceiveVideo: 1});\n        await this.onCreateOfferSuccess(offer);\n      } catch (e) {\n        this.onCreateSessionDescriptionError(e);\n      }\n    },\n    onCreateSessionDescriptionError(error) {\n      console.log(`Failed to create session description: ${error.toString()}`);\n    },\n    async onCreateOfferSuccess(desc) {\n      console.log(`Offer from pc1\\n${desc.sdp}`);\n      console.log('pc1 setLocalDescription start');\n      try {\n        await this.pc1.setLocalDescription(desc);\n        this.onSetLocalSuccess(this.pc1);\n      } catch (e) {\n        this.onSetSessionDescriptionError(e);\n      }\n\n      console.log('pc2 setRemoteDescription start');\n      try {\n        await this.pc2.setRemoteDescription(desc);\n        this.onSetRemoteSuccess(this.pc2);\n      } catch (e) {\n        this.onSetSessionDescriptionError(e);\n      }\n\n      console.log('pc2 createAnswer start');\n      try {\n        const answer = await this.pc2.createAnswer();\n        await this.onCreateAnswerSuccess(answer);\n      } catch (e) {\n        this.onCreateSessionDescriptionError(e);\n      }\n    },\n    onSetLocalSuccess(pc) {\n      console.log(`${this.getName(pc)} setLocalDescription complete`);\n    },\n    onSetRemoteSuccess(pc) {\n      console.log(`${this.getName(pc)} setRemoteDescription complete`);\n    },\n    onSetSessionDescriptionError(error) {\n      console.log(`Failed to set session description: ${error.toString()}`);\n    },\n    gotRemoteStream(e) {\n      if (this.$refs.remoteVideo.srcObject !== e.streams[0]) {\n        this.$refs.remoteVideo.srcObject = e.streams[0];\n        console.log('pc2 received remote stream', e.streams[0]);\n      }\n    },\n    async onCreateAnswerSuccess(desc) {\n      console.log(`Answer from pc2:\\n${desc.sdp}`);\n      console.log('pc2 setLocalDescription start');\n      try {\n        await this.pc2.setLocalDescription(desc);\n        this.onSetLocalSuccess(this.pc2);\n      } catch (e) {\n        this.onSetSessionDescriptionError(e);\n      }\n      console.log('pc1 setRemoteDescription start');\n      try {\n        await this.pc1.setRemoteDescription(desc);\n        this.onSetRemoteSuccess(this.pc1);\n      } catch (e) {\n        this.onSetSessionDescriptionError(e);\n      }\n    },\n    async onIceCandidate(pc, event) {\n      try {\n        if (event.candidate) {\n          await this.getOtherPc(pc).addIceCandidate(event.candidate);\n          this.onAddIceCandidateSuccess(pc);\n        }\n      } catch (e) {\n        this.onAddIceCandidateError(pc, e);\n      }\n      console.log(`${this.getName(pc)} ICE candidate:\\n${event.candidate ? event.candidate.candidate : '(null)'}`);\n    },\n    onAddIceCandidateSuccess(pc) {\n      console.log(`${this.getName(pc)} addIceCandidate success`);\n    },\n    onAddIceCandidateError(pc, error) {\n      console.log(`${this.getName(pc)} failed to add ICE Candidate: ${error.toString()}`);\n    },\n    onIceStateChange(pc, event) {\n      if (pc) {\n        console.log(`${this.getName(pc)} ICE state: ${pc.iceConnectionState}`);\n        console.log('ICE state change event: ', event);\n      }\n    },\n    async join() {\n      this.isCaller = false;\n      this.callId = this.$refs.callInput.value;\n      console.log(\"join\", this.callId)\n      this.pc.onicecandidate = (event) => {\n\n\n        if (event.candidate) {\n          const cand = event.candidate.candidate;\n          const typeMatch = cand.match(/ typ ([a-z]+)/);\n          if (typeMatch) {\n            const candidateType = typeMatch[1];\n            console.log('[NAT] 发现 candidate 类型:', candidateType);\n            // 你可以在页面上显示\n            // this.natType = candidateType;\n          }\n\n          this.socket.send(JSON.stringify({\n            type: 'candidate',\n            callId: this.callId,\n            candidate: event.candidate,\n          }));\n        }\n      };\n      this.socket.send(JSON.stringify({\n        type: 'join',\n        callId: this.callId,\n      }));\n      // offer 会通过 onSocketMessage 收到\n      // 生成 answer\n      this.pc.onnegotiationneeded = async () => {\n        const answerDescription = await this.pc.createAnswer();\n        await this.pc.setLocalDescription(answerDescription);\n        this.socket.send(JSON.stringify({\n          type: 'answer',\n          callId: this.callId,\n          answer: answerDescription,\n        }));\n      };\n    },\n    async hangup() {\n      console.log('Ending call');\n      this.pc1.close();\n      this.pc2.close();\n      this.pc1 = null;\n      this.pc2 = null;\n      this.hangButtonDisabled = true;\n      this.callButtonDisabled = false;\n    },\n    getName(pc) {\n      return (pc === this.pc1) ? 'pc1' : 'pc2';\n    },\n    getOtherPc(pc) {\n      return (pc === this.pc1) ? this.pc2 : this.pc1;\n    }\n  }\n}\n</script>\n\n<style>\nvideo {\n  width: 40vw;\n  height: 30vw;\n  margin: 2rem;\n  background: #2c3e50;\n}\n\n.videos {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n</style>\n","import { render } from \"./HomeView2.vue?vue&type=template&id=491a48fc\"\nimport script from \"./HomeView2.vue?vue&type=script&lang=js\"\nexport * from \"./HomeView2.vue?vue&type=script&lang=js\"\n\nimport \"./HomeView2.vue?vue&type=style&index=0&id=491a48fc&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","id","ref","autoplay","playsinline","controls","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","onClick","_cache","args","$options","start","disabled","$data","webcamButtonDisabled","_hoisted_4","create","callButtonDisabled","_hoisted_5","_hoisted_6","join","answerButtonDisabled","_hoisted_7","hangup","hangButtonDisabled","_hoisted_8","servers","iceServers","urls","username","credential","iceCandidatePoolSize","name","components","HelloWorld","data","localStream","remoteStream","pc1","pc2","socket","callId","isCaller","startTime","created","this","WebSocket","onopen","console","log","onclose","event","wasClean","code","reason","onerror","error","onmessage","onSocketMessage","mounted","$refs","webcamVideo","addEventListener","videoWidth","videoHeight","remoteVideo","performance","now","toFixed","elapsedTime","window","methods","msg","JSON","parse","type","pc","setRemoteDescription","RTCSessionDescription","offer","answer","addIceCandidate","RTCIceCandidate","candidate","then","catch","e","stream","navigator","mediaDevices","getUserMedia","audio","video","srcObject","alert","videoTracks","getVideoTracks","audioTracks","getAudioTracks","length","label","configuration","RTCPeerConnection","onIceCandidate","onIceStateChange","gotRemoteStream","getTracks","forEach","track","addTrack","createOffer","offerToReceiveAudio","offerToReceiveVideo","onCreateOfferSuccess","onCreateSessionDescriptionError","toString","desc","sdp","setLocalDescription","onSetLocalSuccess","onSetSessionDescriptionError","onSetRemoteSuccess","createAnswer","onCreateAnswerSuccess","getName","streams","getOtherPc","onAddIceCandidateSuccess","onAddIceCandidateError","iceConnectionState","callInput","value","onicecandidate","cand","typeMatch","match","candidateType","send","stringify","onnegotiationneeded","async","answerDescription","close","__exports__","render"],"sourceRoot":""}