(function(){"use strict";var e={1814:function(e,t,a){a.d(t,{A:function(){return d}});var n=a(6768),o=a(4232);const r={class:"hello"};function i(e,t,a,i,l,s){return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.Lk)("h1",null,(0,o.v_)(a.msg),1),t[0]||(t[0]=(0,n.Fv)('<p data-v-1935ec24> For a guide and recipes on how to configure / customize this project,<br data-v-1935ec24> check out the <a href="https://cli.vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>vue-cli documentation</a>. </p><h3 data-v-1935ec24>Installed CLI Plugins</h3><ul data-v-1935ec24><li data-v-1935ec24><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-babel" target="_blank" rel="noopener" data-v-1935ec24>babel</a></li><li data-v-1935ec24><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-router" target="_blank" rel="noopener" data-v-1935ec24>router</a></li><li data-v-1935ec24><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-vuex" target="_blank" rel="noopener" data-v-1935ec24>vuex</a></li></ul><h3 data-v-1935ec24>Essential Links</h3><ul data-v-1935ec24><li data-v-1935ec24><a href="https://vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>Core Docs</a></li><li data-v-1935ec24><a href="https://forum.vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>Forum</a></li><li data-v-1935ec24><a href="https://chat.vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>Community Chat</a></li><li data-v-1935ec24><a href="https://twitter.com/vuejs" target="_blank" rel="noopener" data-v-1935ec24>Twitter</a></li><li data-v-1935ec24><a href="https://news.vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>News</a></li></ul><h3 data-v-1935ec24>Ecosystem</h3><ul data-v-1935ec24><li data-v-1935ec24><a href="https://router.vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>vue-router</a></li><li data-v-1935ec24><a href="https://vuex.vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>vuex</a></li><li data-v-1935ec24><a href="https://github.com/vuejs/vue-devtools#vue-devtools" target="_blank" rel="noopener" data-v-1935ec24>vue-devtools</a></li><li data-v-1935ec24><a href="https://vue-loader.vuejs.org" target="_blank" rel="noopener" data-v-1935ec24>vue-loader</a></li><li data-v-1935ec24><a href="https://github.com/vuejs/awesome-vue" target="_blank" rel="noopener" data-v-1935ec24>awesome-vue</a></li></ul>',7))])}var l={name:"HelloWorld",props:{msg:String}},s=a(1241);const c=(0,s.A)(l,[["render",i],["__scopeId","data-v-1935ec24"]]);var d=c},4699:function(e,t,a){var n=a(5130),o=a(6768);function r(e,t){const a=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.Wv)(a)}var i=a(1241);const l={},s=(0,i.A)(l,[["render",r]]);var c=s,d=a(1387),u=a(4232);const h={class:"videos"},p={id:"webcamVideo",ref:"webcamVideo",autoplay:"",playsinline:""},f={id:"remoteVideo",ref:"remoteVideo",autoplay:"",playsinline:""},v={style:{margin:"1em 0"}},m=["disabled"],b=["disabled"],g=["disabled"],k=["disabled"];function w(e,t,a,r,i,l){return(0,o.uX)(),(0,o.CE)(o.FK,null,[t[8]||(t[8]=(0,o.Lk)("h2",null,"1. Start your Webcam",-1)),(0,o.Lk)("div",h,[(0,o.Lk)("span",null,[t[5]||(t[5]=(0,o.Lk)("h3",null,"Local Stream",-1)),(0,o.Lk)("video",p,null,512)]),(0,o.Lk)("span",null,[t[6]||(t[6]=(0,o.Lk)("h3",null,"Remote Stream",-1)),(0,o.Lk)("video",f,null,512)])]),(0,o.Lk)("div",v,[t[7]||(t[7]=(0,o.Lk)("b",null,"PeerConnection State:",-1)),(0,o.eW)(" "+(0,u.v_)(e.connectionState),1)]),(0,o.Lk)("button",{id:"webcamButton",onClick:t[0]||(t[0]=(...e)=>l.start&&l.start(...e)),disabled:e.webcamButtonDisabled},"Start webcam",8,m),t[9]||(t[9]=(0,o.Lk)("h2",null,"2. Create a new Call",-1)),(0,o.Lk)("button",{id:"callButton",onClick:t[1]||(t[1]=(...e)=>l.call&&l.call(...e)),disabled:e.callButtonDisabled},"Create Call (offer)",8,b),t[10]||(t[10]=(0,o.Lk)("h2",null,"3. Join a Call",-1)),t[11]||(t[11]=(0,o.Lk)("p",null,"Answer the call from a different browser window or device",-1)),(0,o.bo)((0,o.Lk)("input",{id:"callInput",ref:"callInput","onUpdate:modelValue":t[2]||(t[2]=t=>e.callId=t)},null,512),[[n.Jo,e.callId]]),(0,o.Lk)("button",{id:"answerButton",onClick:t[3]||(t[3]=(...e)=>l.answer&&l.answer(...e)),disabled:e.answerButtonDisabled},"Answer",8,g),t[12]||(t[12]=(0,o.Lk)("h2",null,"4. Hangup",-1)),(0,o.Lk)("button",{id:"hangupButton",onClick:t[4]||(t[4]=(...e)=>l.hangup&&l.hangup(...e)),disabled:e.hangButtonDisabled},"Hangup",8,k)],64)}a(4114),a(8111),a(7588);var y=a(1814),C=a(4373);const S="https://webrtcserverdemo-production.up.railway.app/",j={iceServers:[{urls:["stun:stun.l.google.com:19302"]}],iceCandidatePoolSize:10,iceTransportPolicy:"all"};var L={name:"HomeView",components:{HelloWorld:y.A},data:()=>({localStream:null,remoteStream:null,callButtonDisabled:!1,answerButtonDisabled:!1,webcamButtonDisabled:!1,hangButtonDisabled:!1,pc:new RTCPeerConnection(j),socket:null,callId:"",isCaller:!1,callerCandidates:[],answerCandidates:[],connectionState:"new"}),created(){this.socket=new WebSocket(S),this.socket.onopen=()=>{console.log("[WebSocket] 连接成功")},this.socket.onclose=e=>{e.wasClean?console.log(`[WebSocket] 连接正常关闭, code=${e.code}, reason=${e.reason}`):console.log("[WebSocket] 连接异常断开")},this.socket.onerror=e=>{console.error("[WebSocket] 发生错误:",e)},this.socket.onmessage=this.onSocketMessage,this.pc.onconnectionstatechange=()=>{this.connectionState=this.pc.connectionState},this.connectionState=this.pc.connectionState},methods:{onSocketMessage(e){const t=JSON.parse(e.data);if(console.log("websocket msg",t),"answer"===t.type&&this.isCaller){const e=new RTCSessionDescription(t.answer);this.pc.setRemoteDescription(e)}if("candidate"===t.type){const e=t.candidate;this.answerCandidates.push(e),this.pc.addIceCandidate(new RTCIceCandidate(e))}},async start(){console.log("webcamButton"),this.localStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),this.remoteStream=new MediaStream,this.localStream.getTracks().forEach(e=>{this.pc.addTrack(e,this.localStream)}),this.pc.ontrack=e=>{e.streams[0].getTracks().forEach(e=>{console.log("remoteStream",e),this.remoteStream.addTrack(e)}),this.$refs.remoteVideo.srcObject=this.remoteStream},this.$refs.webcamVideo.srcObject=this.localStream,this.$refs.webcamVideo.muted=!0,console.log("this.localStream",this.localStream),this.$refs.remoteVideo.srcObject=this.remoteStream,this.callButtonDisabled=!1,this.answerButtonDisabled=!1,this.webcamButtonDisabled=!0},async call(){this.hangButtonDisabled=!1,this.answerButtonDisabled=!0,this.isCaller=!0,this.callId=Math.random().toString(36).substr(2,4),this.pc.onicecandidate=e=>{if(e.candidate){e.candidate.candidate;this.socket.send(JSON.stringify({type:"candidate",callId:this.callId,candidate:e.candidate})),this.callerCandidates.push(e.candidate)}};const e=await this.pc.createOffer();await this.pc.setLocalDescription(e);const t={sdp:e.sdp,type:e.type};this.socket.send(JSON.stringify({type:"offer",callId:this.callId,offer:t})),this.hangButtonDisabled=!1},async answer(){this.isCaller=!1,console.log("join",this.callId);const e=await C.A.get(S+"offer/"+this.callId);console.log("callData",e.data),this.pc.onicecandidate=e=>{e.candidate&&(this.socket.send(JSON.stringify({type:"candidate",callId:this.callId,candidate:e.candidate})),this.answerCandidates.push(e.candidate.toJSON()))},this.socket.send(JSON.stringify({type:"join",callId:this.callId}));const t=e.data.offer;console.log("offerDescription",t),await this.pc.setRemoteDescription(new RTCSessionDescription(t));const a=await this.pc.createAnswer();await this.pc.setLocalDescription(a);const n={type:a.type,sdp:a.sdp};this.socket.send(JSON.stringify({type:"answer",callId:this.callId,answer:n})),this.callerCandidates=e.data.callerCandidates;for(let o=0;o<e.data.callerCandidates.length;o++)await this.pc.addIceCandidate(new RTCIceCandidate(e.data.callerCandidates[o]));this.hangButtonDisabled=!1,this.answerButtonDisabled=!0},async hangup(){this.pc.close(),this.pc.onicecandidate=null,location.reload()}}};const D=(0,i.A)(L,[["render",w]]);var _=D;const I=[{path:"/",name:"home",component:_},{path:"/loop",name:"loop",component:()=>a.e(594).then(a.bind(a,1261))},{path:"/seed",name:"seed",component:()=>a.e(594).then(a.bind(a,16))}],O=(0,d.aE)({history:(0,d.LA)("/webrtc_demo/"),routes:I});var B=O,E=a(782),T=(0,E.y$)({state:{},getters:{},mutations:{},actions:{},modules:{}});(0,n.Ef)(c).use(T).use(B).mount("#app")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,n,o,r){if(!n){var i=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],r=e[d][2];for(var l=!0,s=0;s<n.length;s++)(!1&r||i>=r)&&Object.keys(a.O).every(function(e){return a.O[e](n[s])})?n.splice(s--,1):(l=!1,r<i&&(i=r));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,o,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce(function(t,n){return a.f[n](e,t),t},[]))}}(),function(){a.u=function(e){return"js/about.dd1d3c33.js"}}(),function(){a.miniCssF=function(e){return"css/about.7ee1bb2b.css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="untitled10:";a.l=function(n,o,r,i){if(e[n])e[n].push(o);else{var l,s;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+r){l=u;break}}l||(s=!0,l=document.createElement("script"),l.charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+r),l.src=n),e[n]=[o];var h=function(t,a){l.onerror=l.onload=null,clearTimeout(p);var o=e[n];if(delete e[n],l.parentNode&&l.parentNode.removeChild(l),o&&o.forEach(function(e){return e(a)}),t)return t(a)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=h.bind(null,l.onerror),l.onload=h.bind(null,l.onload),s&&document.head.appendChild(l)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/webrtc_demo/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,n,o,r){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",a.nc&&(i.nonce=a.nc);var l=function(a){if(i.onerror=i.onload=null,"load"===a.type)o();else{var n=a&&a.type,l=a&&a.target&&a.target.href||t,s=new Error("Loading CSS chunk "+e+" failed.\n("+n+": "+l+")");s.name="ChunkLoadError",s.code="CSS_CHUNK_LOAD_FAILED",s.type=n,s.request=l,i.parentNode&&i.parentNode.removeChild(i),r(s)}};return i.onerror=i.onload=l,i.href=t,n?n.parentNode.insertBefore(i,n.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var a=document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n],r=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(r===e||r===t))return o}var i=document.getElementsByTagName("style");for(n=0;n<i.length;n++){o=i[n],r=o.getAttribute("data-href");if(r===e||r===t)return o}},n=function(n){return new Promise(function(o,r){var i=a.miniCssF(n),l=a.p+i;if(t(i,l))return o();e(n,l,null,o,r)})},o={524:0};a.f.miniCss=function(e,t){var a={594:1};o[e]?t.push(o[e]):0!==o[e]&&a[e]&&t.push(o[e]=n(e).then(function(){o[e]=0},function(t){throw delete o[e],t}))}}}(),function(){var e={524:0};a.f.j=function(t,n){var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise(function(a,n){o=e[t]=[a,n]});n.push(o[2]=r);var i=a.p+a.u(t),l=new Error,s=function(n){if(a.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",l.name="ChunkLoadError",l.type=r,l.request=i,o[1](l)}};a.l(i,s,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,r,i=n[0],l=n[1],s=n[2],c=0;if(i.some(function(t){return 0!==e[t]})){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(s)var d=s(a)}for(t&&t(n);c<i.length;c++)r=i[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},n=self["webpackChunkuntitled10"]=self["webpackChunkuntitled10"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[504],function(){return a(4699)});n=a.O(n)})();
//# sourceMappingURL=app.0f584cf4.js.map